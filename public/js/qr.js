"use strict";var paulmillrQr=(()=>{var W=Object.defineProperty;var Dt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Lt=Object.prototype.hasOwnProperty;var st=(e,t)=>{for(var n in t)W(e,n,{get:t[n],enumerable:!0})},Ot=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Nt(t))!Lt.call(e,r)&&r!==n&&W(e,r,{get:()=>t[r],enumerable:!(o=Dt(t,r))||o.enumerable});return e};var Ut=e=>Ot(W({},"__esModule",{value:!0}),e);var Ae={};st(Ae,{Bitmap:()=>D,ECMode:()=>j,Encoding:()=>F,decodeQR:()=>et,dom:()=>ot,encodeQR:()=>xt});var q={newline:10,reset:27};function qt(e){if(!Number.isSafeInteger(e))throw new Error(`integer expected: ${e}`)}function ut(e){if(!Number.isSafeInteger(e)||e<1||e>40)throw new Error(`Invalid version=${e}. Expected number [1..40]`)}function N(e,t){return e.toString(2).padStart(t,"0")}function at(e,t){let n=e%t;return n>=0?n:t+n}function P(e,t){return new Array(e).fill(t)}function lt(...e){let t=0;for(let o of e)t=Math.max(t,o.length);let n=[];for(let o=0;o<t;o++)for(let r of e)o>=r.length||n.push(r[o]);return new Uint8Array(n)}function ct(e,t,n){if(n<0||n+t.length>e.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==e[n+o])return!1;return!0}function yt(){let e,t=1/0;return{add(n,o){n>=t||(e=o,t=n)},get:()=>e,score:()=>t}}function ft(e){return{has:t=>e.includes(t),decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let o=e.indexOf(n);if(o===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return o})},encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(qt(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})}}}var D=class e{static size(t,n){if(typeof t=="number"&&(t={height:t,width:t}),!Number.isSafeInteger(t.height)&&t.height!==1/0)throw new Error(`Bitmap: invalid height=${t.height} (${typeof t.height})`);if(!Number.isSafeInteger(t.width)&&t.width!==1/0)throw new Error(`Bitmap: invalid width=${t.width} (${typeof t.width})`);return n!==void 0&&(t={width:Math.min(t.width,n.width),height:Math.min(t.height,n.height)}),t}static fromString(t){t=t.replace(/^\n+/g,"").replace(/\n+$/g,"");let n=t.split(String.fromCharCode(q.newline)),o=n.length,r=new Array(o),i;for(let a of n){let s=a.split("").map(c=>{if(c==="X")return!0;if(c===" ")return!1;if(c!=="?")throw new Error(`Bitmap.fromString: unknown symbol=${c}`)});if(i&&s.length!==i)throw new Error(`Bitmap.fromString different row sizes: width=${i} cur=${s.length}`);i=s.length,r.push(s)}return i||(i=0),new e({height:o,width:i},r)}constructor(t,n){let{height:o,width:r}=e.size(t);this.data=n||Array.from({length:o},()=>P(r,void 0)),this.height=o,this.width=r}point(t){return this.data[t.y][t.x]}isInside(t){return 0<=t.x&&t.x<this.width&&0<=t.y&&t.y<this.height}size(t){if(!t)return{height:this.height,width:this.width};let{x:n,y:o}=this.xy(t);return{height:this.height-o,width:this.width-n}}xy(t){if(typeof t=="number"&&(t={x:t,y:t}),!Number.isSafeInteger(t.x))throw new Error(`Bitmap: invalid x=${t.x}`);if(!Number.isSafeInteger(t.y))throw new Error(`Bitmap: invalid y=${t.y}`);return t.x=at(t.x,this.width),t.y=at(t.y,this.height),t}rect(t,n,o){let{x:r,y:i}=this.xy(t),{height:a,width:s}=e.size(n,this.size({x:r,y:i}));for(let c=0;c<a;c++)for(let h=0;h<s;h++)this.data[i+c][r+h]=typeof o=="function"?o({x:h,y:c},this.data[i+c][r+h]):o;return this}rectRead(t,n,o){return this.rect(t,n,(r,i)=>(o(r,i),i))}hLine(t,n,o){return this.rect(t,{width:n,height:1},o)}vLine(t,n,o){return this.rect(t,{width:1,height:n},o)}border(t=2,n){let o=this.height+2*t,r=this.width+2*t,i=P(t,n),a=Array.from({length:t},()=>P(r,n));return new e({height:o,width:r},[...a,...this.data.map(s=>[...i,...s,...i]),...a])}embed(t,n){return this.rect(t,n.size(),({x:o,y:r})=>n.data[r][o])}rectSlice(t,n=this.size()){let o=new e(e.size(n,this.size(this.xy(t))));return this.rect(t,n,({x:r,y:i},a)=>o.data[i][r]=a),o}inverse(){let{height:t,width:n}=this;return new e({height:n,width:t}).rect({x:0,y:0},1/0,({x:r,y:i})=>this.data[r][i])}scale(t){if(!Number.isSafeInteger(t)||t>1024)throw new Error(`invalid scale factor: ${t}`);let{height:n,width:o}=this;return new e({height:t*n,width:t*o}).rect({x:0,y:0},1/0,({x:i,y:a})=>this.data[Math.floor(a/t)][Math.floor(i/t)])}clone(){return new e(this.size()).rect({x:0,y:0},this.size(),({x:n,y:o})=>this.data[o][n])}assertDrawn(){this.rectRead(0,1/0,(t,n)=>{if(typeof n!="boolean")throw new Error(`Invalid color type=${typeof n}`)})}toString(){return this.data.map(t=>t.map(n=>n===void 0?"?":n?"X":" ").join("")).join(String.fromCharCode(q.newline))}toASCII(){let{height:t,width:n,data:o}=this,r="";for(let i=0;i<t;i+=2){for(let a=0;a<n;a++){let s=o[i][a],c=i+1>=t?!0:o[i+1][a];!s&&!c?r+="\u2588":!s&&c?r+="\u2580":s&&!c?r+="\u2584":s&&c&&(r+=" ")}r+=String.fromCharCode(q.newline)}return r}toTerm(){let t=String.fromCharCode(q.reset),n=t+"[0m",o=t+"[1;47m  "+n,r=t+"[40m  "+n;return this.data.map(i=>i.map(a=>a?r:o).join("")).join(String.fromCharCode(q.newline))}toSVG(){let t=`<svg xmlns:svg="http://www.w3.org/2000/svg" viewBox="0 0 ${this.width} ${this.height}" version="1.1" xmlns="http://www.w3.org/2000/svg">`;return this.rectRead(0,1/0,({x:n,y:o},r)=>{r&&(t+=`<rect x="${n}" y="${o}" width="1" height="1" />`)}),t+="</svg>",t}toGIF(){let t=s=>[s&255,s>>>8&255],n=[...t(this.width),...t(this.height)],o=[];this.rectRead(0,1/0,(s,c)=>o.push(+(c===!0)));let r=126,i=[71,73,70,56,55,97,...n,246,0,0,255,255,255,...P(3*127,0),44,0,0,0,0,...n,0,7],a=Math.floor(o.length/r);for(let s=0;s<a;s++)i.push(r+1,128,...o.slice(r*s,r*(s+1)).map(c=>+c));return i.push(o.length%r+1,128,...o.slice(a*r).map(s=>+s)),i.push(1,129,0,59),new Uint8Array(i)}toImage(t=!1){let{height:n,width:o}=this.size(),r=new Uint8Array(n*o*(t?3:4)),i=0;for(let a=0;a<n;a++)for(let s=0;s<o;s++){let c=this.data[a][s]?0:255;r[i++]=c,r[i++]=c,r[i++]=c,t||(r[i++]=255)}return{height:n,width:o,data:r}}},j=["low","medium","quartile","high"],F=["numeric","alphanumeric","byte","kanji","eci"],jt=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],Ft={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]},Qt={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]},k={size:{encode:e=>21+4*(e-1),decode:e=>(e-17)/4},sizeType:e=>Math.floor((e+7)/17),alignmentPatterns(e){if(e===1)return[];let t=6,n=k.size.encode(e)-t-1,o=n-t,r=Math.ceil(o/28),i=Math.floor(o/r);i%2?i+=1:o%r*2>=r&&(i+=2);let a=[t];for(let s=1;s<r;s++)a.push(n-(r-s)*i);return a.push(n),a},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits(e,t){let n=k.ECCode[e]<<3|t,o=n;for(let r=0;r<10;r++)o=o<<1^(o>>9)*1335;return(n<<10|o)^k.formatMask},versionBits(e){let t=e;for(let n=0;n<12;n++)t=t<<1^(t>>11)*7973;return e<<12|t},alphabet:{numeric:ft("0123456789"),alphanumerc:ft("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits(e,t){return{numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]}[t][k.sizeType(e)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity(e,t){let n=jt[e-1],o=Ft[t][e-1],r=Qt[t][e-1],i=Math.floor(n/r)-o,a=r-n%r;return{words:o,numBlocks:r,shortBlocks:a,blockLen:i,capacity:(n-o*r)*8,total:(o+i)*r+r-a}}},Z=[(e,t)=>(e+t)%2==0,(e,t)=>t%2==0,(e,t)=>e%3==0,(e,t)=>(e+t)%3==0,(e,t)=>(Math.floor(t/2)+Math.floor(e/3))%2==0,(e,t)=>e*t%2+e*t%3==0,(e,t)=>(e*t%2+e*t%3)%2==0,(e,t)=>((e+t)%2+e*t%3)%2==0],y={tables:(e=>{let t=P(256,0),n=P(256,0);for(let o=0,r=1;o<256;o++)t[o]=r,n[r]=o,r<<=1,r&256&&(r^=e);return{exp:t,log:n}})(285),exp:e=>y.tables.exp[e],log(e){if(e===0)throw new Error(`GF.log: invalid arg=${e}`);return y.tables.log[e]%255},mul(e,t){return e===0||t===0?0:y.tables.exp[(y.tables.log[e]+y.tables.log[t])%255]},add:(e,t)=>e^t,pow:(e,t)=>y.tables.exp[y.tables.log[e]*t%255],inv(e){if(e===0)throw new Error(`GF.inverse: invalid arg=${e}`);return y.tables.exp[255-y.tables.log[e]]},polynomial(e){if(e.length==0)throw new Error("GF.polymomial: invalid length");if(e[0]!==0)return e;let t=0;for(;t<e.length-1&&e[t]==0;t++);return e.slice(t)},monomial(e,t){if(e<0)throw new Error(`GF.monomial: invalid degree=${e}`);if(t==0)return[0];let n=P(e+1,0);return n[0]=t,y.polynomial(n)},degree:e=>e.length-1,coefficient:(e,t)=>e[y.degree(e)-t],mulPoly(e,t){if(e[0]===0||t[0]===0)return[0];let n=P(e.length+t.length-1,0);for(let o=0;o<e.length;o++)for(let r=0;r<t.length;r++)n[o+r]=y.add(n[o+r],y.mul(e[o],t[r]));return y.polynomial(n)},mulPolyScalar(e,t){if(t==0)return[0];if(t==1)return e;let n=P(e.length,0);for(let o=0;o<e.length;o++)n[o]=y.mul(e[o],t);return y.polynomial(n)},mulPolyMonomial(e,t,n){if(t<0)throw new Error("GF.mulPolyMonomial: invalid degree");if(n==0)return[0];let o=P(e.length+t,0);for(let r=0;r<e.length;r++)o[r]=y.mul(e[r],n);return y.polynomial(o)},addPoly(e,t){if(e[0]===0)return t;if(t[0]===0)return e;let n=e,o=t;n.length>o.length&&([n,o]=[o,n]);let r=P(o.length,0),i=o.length-n.length,a=o.slice(0,i);for(let s=0;s<a.length;s++)r[s]=a[s];for(let s=i;s<o.length;s++)r[s]=y.add(n[s-i],o[s]);return y.polynomial(r)},remainderPoly(e,t){let n=Array.from(e);for(let o=0;o<e.length-t.length+1;o++){let r=n[o];if(r!==0)for(let i=1;i<t.length;i++)t[i]!==0&&(n[o+i]=y.add(n[o+i],y.mul(t[i],r)))}return n.slice(e.length-t.length+1,n.length)},divisorPoly(e){let t=[1];for(let n=0;n<e;n++)t=y.mulPoly(t,[1,y.pow(2,n)]);return t},evalPoly(e,t){if(t==0)return y.coefficient(e,0);let n=e[0];for(let o=1;o<e.length;o++)n=y.add(y.mul(t,n),e[o]);return n},euclidian(e,t,n){y.degree(e)<y.degree(t)&&([e,t]=[t,e]);let o=e,r=t,i=[0],a=[1];for(;2*y.degree(r)>=n;){let h=o,f=i;if(o=r,i=a,o[0]===0)throw new Error("rLast[0] === 0");r=h;let l=[0],u=y.inv(o[0]);for(;y.degree(r)>=y.degree(o)&&r[0]!==0;){let d=y.degree(r)-y.degree(o),w=y.mul(r[0],u);l=y.addPoly(l,y.monomial(d,w)),r=y.addPoly(r,y.mulPolyMonomial(o,d,w))}if(l=y.mulPoly(l,i),a=y.addPoly(l,f),y.degree(r)>=y.degree(o))throw new Error(`Division failed r: ${r}, rLast: ${o}`)}let s=y.coefficient(a,0);if(s==0)throw new Error("sigmaTilde(0) was zero");let c=y.inv(s);return[y.mulPolyScalar(a,c),y.mulPolyScalar(r,c)]}};function Gt(e){return{encode(t){let n=y.divisorPoly(e),o=Array.from(t);return o.push(...n.slice(0,-1).fill(0)),Uint8Array.from(y.remainderPoly(o,n))},decode(t){let n=t.slice(),o=y.polynomial(Array.from(t)),r=P(e,0),i=!1;for(let l=0;l<e;l++){let u=y.evalPoly(o,y.exp(l));r[r.length-1-l]=u,u!==0&&(i=!0)}if(!i)return n;r=y.polynomial(r);let a=y.monomial(e,1),[s,c]=y.euclidian(a,r,e),h=P(y.degree(s),0),f=0;for(let l=1;l<256&&f<h.length;l++)y.evalPoly(s,l)===0&&(h[f++]=y.inv(l));if(f!==h.length)throw new Error("RS.decode: invalid errors number");for(let l=0;l<h.length;l++){let u=n.length-1-y.log(h[l]);if(u<0)throw new Error("RS.decode: invalid error location");let d=y.inv(h[l]),w=1;for(let g=0;g<h.length;g++)l!==g&&(w=y.mul(w,y.add(1,y.mul(h[g],d))));n[u]=y.add(n[u],y.mul(y.evalPoly(c,d),y.inv(w)))}return n}}}function mt(e,t){let{words:n,shortBlocks:o,numBlocks:r,blockLen:i,total:a}=k.capacity(e,t),s=Gt(n);return{encode(c){let h=[],f=[];for(let w=0;w<r;w++){let g=w<o,x=i+(g?0:1);h.push(c.subarray(0,x)),f.push(s.encode(c.subarray(0,x))),c=c.subarray(x)}let l=lt(...h),u=lt(...f),d=new Uint8Array(l.length+u.length);return d.set(l),d.set(u,l.length),d},decode(c){if(c.length!==a)throw new Error(`interleave.decode: len(data)=${c.length}, total=${a}`);let h=[];for(let u=0;u<r;u++){let d=u<o;h.push(new Uint8Array(n+i+(d?0:1)))}let f=0;for(let u=0;u<i;u++)for(let d=0;d<r;d++)h[d][u]=c[f++];for(let u=o;u<r;u++)h[u][i]=c[f++];for(let u=i;u<i+n;u++)for(let d=0;d<r;d++){let w=d<o;h[d][u+(w?0:1)]=c[f++]}let l=[];for(let u of h)l.push(...Array.from(s.decode(u)).slice(0,-n));return Uint8Array.from(l)}}}function gt(e,t,n,o=!1){let r=k.size.encode(e),i=new D(r+2),a=new D(3).rect(0,3,!0).border(1,!1).border(1,!0).border(1,!1);i=i.embed(0,a).embed({x:-a.width,y:0},a).embed({x:0,y:-a.height},a),i=i.rectSlice(1,r);let s=new D(1).rect(0,1,!0).border(1,!1).border(1,!0),c=k.alignmentPatterns(e);for(let h of c)for(let f of c)i.data[h][f]===void 0&&i.embed({x:f-2,y:h-2},s);i=i.hLine({x:0,y:6},1/0,({x:h},f)=>f===void 0?h%2==0:f).vLine({x:6,y:0},1/0,({y:h},f)=>f===void 0?h%2==0:f);{let h=k.formatBits(t,n),f=l=>!o&&(h>>l&1)==1;for(let l=0;l<6;l++)i.data[l][8]=f(l);for(let l=6;l<8;l++)i.data[l+1][8]=f(l);for(let l=8;l<15;l++)i.data[r-15+l][8]=f(l);for(let l=0;l<8;l++)i.data[8][r-l-1]=f(l);for(let l=8;l<9;l++)i.data[8][15-l-1+1]=f(l);for(let l=9;l<15;l++)i.data[8][15-l-1]=f(l);i.data[r-8][8]=!o}if(e>=7){let h=k.versionBits(e);for(let f=0;f<18;f+=1){let l=!o&&(h>>f&1)==1,u=Math.floor(f/3),d=f%3+r-8-3;i.data[u][d]=l,i.data[d][u]=l}}return i}function wt(e,t,n){let o=e.height,r=Z[t],i=-1,a=o-1;for(let s=o-1;s>0;s-=2){for(s==6&&(s=5);;a+=i){for(let c=0;c<2;c+=1){let h=s-c;e.data[a][h]===void 0&&n(h,a,r(h,a))}if(a+i<0||a+i>=o)break}i=-i}}function _t(e){let t="numeric";for(let n of e)if(!k.alphabet.numeric.has(n)&&(t="alphanumeric",!k.alphabet.alphanumerc.has(n)))return"byte";return t}function Xt(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ht(e,t,n,o){let r="",i=n.length;if(o==="numeric"){let l=k.alphabet.numeric.decode(n.split("")),u=l.length;for(let d=0;d<u-2;d+=3)r+=N(l[d]*100+l[d+1]*10+l[d+2],10);u%3===1?r+=N(l[u-1],4):u%3===2&&(r+=N(l[u-2]*10+l[u-1],7))}else if(o==="alphanumeric"){let l=k.alphabet.alphanumerc.decode(n.split("")),u=l.length;for(let d=0;d<u-1;d+=2)r+=N(l[d]*45+l[d+1],11);u%2==1&&(r+=N(l[u-1],6))}else if(o==="byte"){let l=Xt(n);i=l.length,r=Array.from(l).map(u=>N(u,8)).join("")}else throw new Error("encode: unsupported type");let{capacity:a}=k.capacity(e,t),s=N(i,k.lengthBits(e,o)),c=k.modeBits[o]+s+r;if(c.length>a)throw new Error("Capacity overflow");c+="0".repeat(Math.min(4,Math.max(0,a-c.length))),c.length%8&&(c+="0".repeat(8-c.length%8));let h="1110110000010001";for(let l=0;c.length!==a;l++)c+=h[l%h.length];let f=Uint8Array.from(c.match(/(.{8})/g).map(l=>+`0b${l}`));return mt(e,t).encode(f)}function dt(e,t,n,o,r=!1){let i=gt(e,t,o,r),a=0,s=8*n.length;if(wt(i,o,(c,h,f)=>{let l=!1;a<s&&(l=(n[a>>>3]>>(7-a&7)&1)!==0,a++),i.data[h][c]=l!==f}),a!==s)throw new Error("QR: bytes left after draw");return i}function Yt(e){let t=e.inverse(),n=d=>{let w=0;for(let g=0,x=1,S=void 0;g<d.length;g++)S===d[g]&&(x++,g!==d.length-1)||(x>=5&&(w+=3+(x-5)),S=d[g],x=1);return w},o=0;e.data.forEach(d=>o+=n(d)),t.data.forEach(d=>o+=n(d));let r=0,i=e.data,a=e.width-1,s=e.height-1;for(let d=0;d<a;d++)for(let w=0;w<s;w++){let g=d+1,x=w+1;i[d][w]===i[g][w]&&i[g][w]===i[d][x]&&i[g][w]===i[g][x]&&(r+=3)}let c=d=>{let w=[!0,!1,!0,!0,!0,!1,!0],g=[!1,!1,!1,!1],x=[...w,...g],S=[...g,...w],p=0;for(let v=0;v<d.length;v++)ct(d,x,v)&&(p+=40),ct(d,S,v)&&(p+=40);return p},h=0;for(let d of e.data)h+=c(d);for(let d of t.data)h+=c(d);let f=0;e.rectRead(0,1/0,(d,w)=>f+=w?1:0);let l=f/(e.height*e.width)*100,u=10*Math.floor(Math.abs(l-50)/5);return o+r+h+u}function Vt(e,t,n,o){if(o===void 0){let r=yt();for(let i=0;i<Z.length;i++)r.add(Yt(dt(e,t,n,i,!0)),i);o=r.get()}if(o===void 0)throw new Error("Cannot find mask");return dt(e,t,n,o)}function Kt(e){if(!j.includes(e))throw new Error(`Invalid error correction mode=${e}. Expected: ${j}`)}function Ht(e){if(!F.includes(e))throw new Error(`Encoding: invalid mode=${e}. Expected: ${F}`);if(e==="kanji"||e==="eci")throw new Error(`Encoding: ${e} is not supported (yet?).`)}function Wt(e){if(![0,1,2,3,4,5,6,7].includes(e)||!Z[e])throw new Error(`Invalid mask=${e}. Expected number [0..7]`)}function xt(e,t="raw",n={}){let o=n.ecc!==void 0?n.ecc:"medium";Kt(o);let r=n.encoding!==void 0?n.encoding:_t(e);Ht(r),n.mask!==void 0&&Wt(n.mask);let i=n.version,a,s=new Error("Unknown error");if(i!==void 0)ut(i),a=ht(i,o,e,r);else for(let f=1;f<=40;f++)try{a=ht(f,o,e,r),i=f;break}catch(l){s=l}if(!i||!a)throw s;let c=Vt(i,o,a,n.mask);c.assertDrawn();let h=n.border===void 0?2:n.border;if(!Number.isSafeInteger(h))throw new Error(`invalid border type=${typeof h}`);if(c=c.border(h,!1),n.scale!==void 0&&(c=c.scale(n.scale)),t==="raw")return c.data;if(t==="ascii")return c.toASCII();if(t==="svg")return c.toSVG();if(t==="gif")return c.toGIF();if(t==="term")return c.toTerm();throw new Error(`Unknown output: ${t}`)}var pt={best:yt,bin:N,drawTemplate:gt,fillArr:P,info:k,interleave:mt,validateVersion:ut,zigzag:wt};var{best:J,bin:Zt,drawTemplate:Jt,fillArr:tt,info:T,interleave:te,validateVersion:$t,zigzag:ee}=pt,vt=3,ne=8,re=24,oe=2,ie=1.333,It=2,se=3,E=e=>e>>>0,_=(e,t)=>{let n=e.x-t.x,o=e.y-t.y;return n*n+o*o},O=(e,t)=>Math.sqrt(_(e,t)),U=e=>e.reduce((t,n)=>t+n),bt=(e,t)=>{e.x+=t.x,e.y+=t.y},ae=e=>({x:-e.x,y:-e.y}),Q=e=>({x:e.y,y:e.x}),St=e=>({x:e.x,y:e.y}),G=e=>({x:E(e.x),y:E(e.y)}),le=(e,t)=>({x:e.x+t.x,y:e.y+t.y});function R(e,t,n){return Math.max(Math.min(e,n||e),t||e)}var kt=e=>{let t=e.data.length/(e.width*e.height);if(t===3||t===4)return t;throw new Error(`Unknown image format, bytes per pixel=${t}`)};function ce(e){let t=kt(e),n=new Uint8Array(e.height*e.width);for(let f=0,l=0,u=e.data;f<u.length;f+=t){let d=u[f],w=u[f+1],g=u[f+2];n[l++]=E((d+2*w+g)/4)&255}let o=ne;if(e.width<o*5||e.height<o*5)throw new Error("image too small");let r=Math.ceil(e.width/o),i=Math.ceil(e.height/o),a=e.height-o,s=e.width-o,c=new Uint8Array(r*i);for(let f=0;f<i;f++){let l=R(f*o,0,a);for(let u=0;u<r;u++){let d=R(u*o,0,s),w=0,g=255,x=0;for(let p=0,v=l*e.width+d;p<o;p=p+1,v=v+e.width)for(let m=0;m<o;m++){let b=n[v+m];w+=b,g=Math.min(g,b),x=Math.max(x,b)}let S=Math.floor(w/o**2);if(x-g<=re&&(S=g/2,f>0&&u>0)){let p=(m,b)=>b*r+m,v=(c[p(u,f-1)]+2*c[p(u-1,f)]+c[p(u-1,f-1)])/4;g<v&&(S=v)}c[r*f+u]=E(S)}}let h=new D({width:e.width,height:e.height});for(let f=0;f<i;f++){let l=R(f*o,0,a),u=R(f,2,i-3);for(let d=0;d<r;d++){let w=R(d*o,0,s),g=R(d,2,r-3),x=0;for(let p=-2;p<=2;p++){let v=r*(u+p)+g;for(let m=-2;m<=2;m++)x+=c[v+m]}let S=x/25;for(let p=0,v=l*e.width+w;p<o;p+=1,v+=e.width)for(let m=0;m<o;m++)n[v+m]<=S&&(h.data[l+p][w+m]=!0)}}return h}function fe(e,t){if(Math.abs(t.y-e.y)<=t.moduleSize&&Math.abs(t.x-e.x)<=t.moduleSize){let n=Math.abs(t.moduleSize-e.moduleSize);return n<=1||n<=e.moduleSize}return!1}function he(e,t){let n=e.count+t.count;return{x:(e.count*e.x+t.count*t.x)/n,y:(e.count*e.y+t.count*t.y)/n,moduleSize:(e.count*e.moduleSize+t.count*t.moduleSize)/n,count:n}}var de=e=>e.filter(t=>t.count>=It);function Ct(e,t){let n=t||tt(e.length,1);if(e.length!==n.length)throw new Error("invalid pattern");if(!(e.length&1))throw new Error("invalid pattern, length should be odd");let o={center:Math.ceil(e.length/2)-1,length:e.length,pattern:e,size:n,runs:()=>tt(e.length,0),totalSize:U(n),total:r=>r.reduce((i,a)=>i+a),shift:(r,i)=>{for(let a=0;a<r.length-i;a++)r[a]=r[a+2];for(let a=r.length-i;a<r.length;a++)r[a]=0},checkSize(r,i,a=oe){let s=i/a;for(let c=0;c<r.length;c++)if(Math.abs(n[c]*i-r[c])>=n[c]*s)return!1;return!0},add(r,i,a,s){let c=s/B.totalSize,h={x:i,y:a,moduleSize:c,count:1};for(let f=0;f<r.length;f++){let l=r[f];if(fe(l,h))return r[f]=he(l,h)}r.push(h)},toCenter(r,i){for(let a=e.length-1;a>o.center;a--)i-=r[a];return i-=r[o.center]/2,i},check(r,i,a,s,c){let h=0,f=St(a),l=ae(s),u=(d,w)=>{for(;r.isInside(f)&&!!r.point(f)===o.pattern[d];bt(f,w))i[d]++,h++;if(i[d]===0)return!0;let g=d===o.center;return!!(c&&!g&&i[d]>o.size[d]*c)};for(let d=o.center;d>=0;d--)if(u(d,l))return!1;f=St(a),bt(f,s),h=1;for(let d=o.center;d<o.length;d++)if(u(d,s))return!1;return h},scanLine(r,i,a,s,c){let h=o.runs(),f=0,l=a;if(a)for(;l<s&&!!r.data[i][l]===o.pattern[0];)l++;for(;l<s;l++){if(!!r.data[i][l]===o.pattern[f]){if(h[f]++,l!==r.width-1)continue;l++}if(f!==o.length-1){h[++f]++;continue}let u=c(h,l);if(u)f=0,h.fill(0);else{if(u===!1)break;o.shift(h,2),f=o.length-2,h[f]++}}}};return o}var B=Ct([!0,!1,!0,!1,!0],[1,1,3,1,1]),L=Ct([!1,!0,!1]);function ue(e){let t=[];function n(m,b=2){let z=U(m);if(z<B.totalSize)return!1;let M=z/B.totalSize;return B.checkSize(m,M,b)}function o(m,b,z,M){let A=B.runs(),$=B.check(e,A,m,M,b);if($===!1)return!1;let I=U(A);return 5*Math.abs(I-z)>=2*z?!1:n(A)?B.toCenter(A,$):!1}function r(m,b,z){if(!n(m))return!1;let M=U(m),A=B.toCenter(m,z),$=o({x:E(A),y:b},m[2],M,{y:1,x:0});if($===!1)return!1;$+=b;let I=o({x:E(A),y:E($)},m[2],M,{y:0,x:1});if(I===!1)return!1;A=I+E(A);let C=B.runs();return!B.check(e,C,{x:E(A),y:E($)},{x:1,y:1})||!n(C,ie)?!1:(B.add(t,A,$,M),!0)}let i=!1,a=R(E(3*e.height/(4*97)),se),s=!1;for(let m=a-1;m<e.height&&!s;m+=a)B.scanLine(e,m,0,e.width,(b,z)=>{if(r(b,m,z)){if(a=2,i){let M=0,A=0;for(let C of t)C.count<It||(M++,A+=C.moduleSize);if(M<3)return;let $=A/t.length,I=0;for(let C of t)I+=Math.abs(C.moduleSize-$);if(I<=.05*A)return s=!0,!1}else if(t.length>1){let M=de(t);if(M.length<2)return!0;i=!0;let A=E((Math.abs(M[0].x-M[1].x)-Math.abs(M[0].y-M[1].y))/2);return A<=b[2]+a?!0:(m+=A-b[2]-a,!1)}}});let c=t.length;if(c<3)throw new Error(`Finder: len(found) = ${c}`);t.sort((m,b)=>m.moduleSize-b.moduleSize);let h=J();for(let m=0;m<c-2;m++){let b=t[m];for(let z=m+1;z<c-1;z++){let M=t[z],A=_(b,M);for(let $=z+1;$<c;$++){let I=t[$];if(I.moduleSize>b.moduleSize*1.4)continue;let C=[A,_(M,I),_(b,I)].sort((Rt,Tt)=>Rt-Tt),K=C[0],H=C[1],it=C[2];h.add(Math.abs(it-2*H)+Math.abs(it-2*K),[b,M,I])}}}let f=h.get();if(!f)throw new Error("cannot find finder");let l=f[0],u=f[1],d=f[2],w=O(l,u),g=O(u,d),x=O(l,d),S=d,p=l,v=u;if(g>=w&&g>=x?(S=l,p=u,v=d):x>=g&&x>=w&&(S=u,p=l,v=d),(v.x-S.x)*(p.y-S.y)-(v.y-S.y)*(p.x-S.x)<0){let m=p;p=v,v=m}return{bl:p,tl:S,tr:v}}function ye(e,t,n){let{moduleSize:o}=t,r=E(n*o),i=R(t.x-r,0),a=R(t.x+r,void 0,e.width-1),s=a-i,c=R(t.y-r,0),h=R(t.y+r,void 0,e.height-1),f=h-c;if(s<o*3||f<o*3)throw new Error(`x = ${s}, y=${f} moduleSize = ${o}`);let l=i,u=c,d=a-i,w=h-c,g=[],x=l+d,S=E(u+w/2);for(let p=0;p<w;p++){let v=E((p+1)/2),m=S+(p&1?-v:v),b;if(L.scanLine(e,m,l,x,(z,M)=>{if(!L.checkSize(z,o))return;let A=U(z),$=L.toCenter(z,M),I=L.runs(),C=L.check(e,I,{x:E($),y:m},{y:1,x:0},2*z[1]);if(C===!1)return;C+=m;let K=U(I);if(5*Math.abs(K-A)>=2*A||!L.checkSize(I,o))return;let H=L.toCenter(I,C);if(b=L.add(g,$,H,A),b)return!1}),b)return b}if(g.length>0)return g[0];throw new Error("Alignment pattern not found")}function Et(e,t,n){let o=!1,r={x:Math.abs(n.x-t.x),y:Math.abs(n.y-t.y)};r.y>r.x&&(o=!0,t=Q(t),n=Q(n),r=Q(r));let i=-r.x/2,a={x:t.x>=n.x?-1:1,y:t.y>=n.y?-1:1},s=0,c=n.x+a.x;for(let h=t.x,f=t.y;h!==c;h+=a.x){let l={x:h,y:f};if(o&&(l=Q(l)),s===1==!!e.point(l)){if(s===2)return O({x:h,y:f},t);s++}if(i+=r.y,!(i<=0)){if(f===n.y)break;f+=a.y,i-=r.x}}return s===2?O({x:n.x+a.x,y:n.y},t):NaN}function At(e,t,n){let o=Et(e,t,n),r=1,{x:i,y:a}=t,s=i-(n.x-i),c=e.width;s<0?(r=i/(i-s),s=0):s>=c&&(r=(c-1-i)/(s-i),s=c-1);let h=E(a-(n.y-a)*r),f=1,l=e.height;return h<0?(f=a/(a-h),h=0):h>=l&&(f=(l-1-a)/(h-a),h=l-1),s=E(i+(s-i)*f),o+=Et(e,t,{x:s,y:h}),o-1}function Mt(e,t,n){let o=At(e,G(t),G(n)),r=At(e,G(n),G(t));return Number.isNaN(o)?r/B.totalSize:Number.isNaN(r)?o/B.totalSize:(o+r)/(2*B.totalSize)}function me(e){let{bl:t,tl:n,tr:o}=ue(e),r=(Mt(e,n,o)+Mt(e,n,t))/2;if(r<1)throw new Error(`invalid moduleSize = ${r}`);let i=E(O(n,o)/r+.5),a=E(O(n,t)/r+.5),s=E((i+a)/2+7),c=s%4;c===0?s++:c===2?s--:c===3&&(s-=2);let h=T.size.decode(s);$t(h);let f;if(T.alignmentPatterns(h).length>0){let p={x:o.x-n.x+t.x,y:o.y-n.y+t.y},v=1-3/(T.size.encode(h)-7),m={x:E(n.x+v*(p.x-n.x)),y:E(n.y+v*(p.y-n.y)),moduleSize:r,count:1};for(let b=4;b<=16;b<<=1)try{f=ye(e,m,b);break}catch{}}let l={x:3.5,y:3.5},u={x:s-3.5,y:3.5},d={x:3.5,y:s-3.5},w,g;f?(w=f,g={x:s-6.5,y:s-6.5}):(w={x:o.x-n.x+t.x,y:o.y-n.y+t.y},g={x:s-3.5,y:s-3.5});let x=[n,o,w,t];return{bits:ge(e,s,x,[l,u,g,d]),points:x}}function zt(e){let t={x:e[0].x-e[1].x+e[2].x-e[3].x,y:e[0].y-e[1].y+e[2].y-e[3].y};if(t.x===0&&t.y===0)return[[e[1].x-e[0].x,e[2].x-e[1].x,e[0].x],[e[1].y-e[0].y,e[2].y-e[1].y,e[0].y],[0,0,1]];{let n={x:e[1].x-e[2].x,y:e[1].y-e[2].y},o={x:e[3].x-e[2].x,y:e[3].y-e[2].y},r=n.x*o.y-o.x*n.y,i=(t.x*o.y-o.x*t.y)/r,a=(n.x*t.y-t.x*n.y)/r;return[[e[1].x-e[0].x+i*e[1].x,e[3].x-e[0].x+a*e[3].x,e[0].x],[e[1].y-e[0].y+i*e[1].y,e[3].y-e[0].y+a*e[3].y,e[0].y],[i,a,1]]}}function ge(e,t,n,o){let r=zt(o),i=[[r[1][1]*r[2][2]-r[2][1]*r[1][2],r[2][1]*r[0][2]-r[0][1]*r[2][2],r[0][1]*r[1][2]-r[1][1]*r[0][2]],[r[2][0]*r[1][2]-r[1][0]*r[2][2],r[0][0]*r[2][2]-r[2][0]*r[0][2],r[1][0]*r[0][2]-r[0][0]*r[1][2]],[r[1][0]*r[2][1]-r[2][0]*r[1][1],r[2][0]*r[0][1]-r[0][0]*r[2][1],r[0][0]*r[1][1]-r[1][0]*r[0][1]]],s=zt(n).map(l=>l.map((u,d)=>l.reduce((w,g,x)=>w+g*i[x][d],0))),c=new D(t),h=tt(2*t,0),f=h.length;for(let l=0;l<t;l++){let u=s;for(let d=0;d<f-1;d+=2){let w=d/2+.5,g=l+.5,x=u[2][0]*w+u[2][1]*g+u[2][2];h[d]=E((u[0][0]*w+u[0][1]*g+u[0][2])/x),h[d+1]=E((u[1][0]*w+u[1][1]*g+u[1][2])/x)}for(let d=0;d<f;d+=2){let w=R(h[d],0,e.width-1),g=R(h[d+1],0,e.height-1);e.data[g][w]&&(c.data[l][d/2]=!0)}}return c}function we(e){let t=(s,c,h)=>h<<1|(e.data[c][s]?1:0),n=e.height,o=0;for(let s=5;s>=0;s--)for(let c=n-9;c>=n-11;c--)o=t(c,s,o);let r=0;for(let s=5;s>=0;s--)for(let c=n-9;c>=n-11;c--)r=t(s,c,r);let i=0;for(let s=0;s<6;s++)i=t(s,8,i);i=t(7,8,i),i=t(8,8,i),i=t(8,7,i);for(let s=5;s>=0;s--)i=t(8,s,i);let a=0;for(let s=n-1;s>=n-7;s--)a=t(8,s,a);for(let s=n-8;s<n;s++)a=t(s,8,a);return{version1:o,version2:r,format1:i,format2:a}}function xe(e){let t=f=>{let l=0;for(;f;)f&1&&l++,f>>=1;return l},n=e.height,{version1:o,version2:r,format1:i,format2:a}=we(e),s,c=J();for(let f of["medium","low","high","quartile"])for(let l=0;l<8;l++){let u=T.formatBits(f,l),d={ecc:f,mask:l};if(u===i||u===a){s=d;break}c.add(t(i^u),d),i!==a&&c.add(t(a^u),d)}if(s===void 0&&c.score()<=vt&&(s=c.get()),s===void 0)throw new Error("invalid format pattern");let h=T.size.decode(n);if(h<7)$t(h);else{h=void 0;let f=J();for(let l=7;l<=40;l++){let u=T.versionBits(l);if(u===o||u===r){h=l;break}f.add(t(o^u),l),o!==r&&f.add(t(r^u),l)}if(h===void 0&&f.score()<=vt&&(h=f.get()),h===void 0)throw new Error("invalid version pattern");if(T.size.encode(h)!==n)throw new Error("invalid version size")}return{version:h,...s}}function pe(e){let t=e.height;if(t<21||(t&3)!==1||t!==e.width)throw new Error(`decode: invalid size=${t}`);let{version:n,mask:o,ecc:r}=xe(e),i=Jt(n,r,o),{total:a}=T.capacity(n,r),s=new Uint8Array(a),c=0,h=0,f=0;if(ee(i,o,(x,S,p)=>{f++,h<<=1,h|=+(!!e.data[S][x]!==p),f===8&&(s[c++]=h,f=0,h=0)}),c!==a)throw new Error(`decode: pos=${c}, total=${a}`);let l=Array.from(te(n,r).decode(s)).map(x=>Zt(x,8)).join(""),u=x=>{if(x>l.length)throw new Error("Not enough bits");let S=l.slice(0,x);return l=l.slice(x),S},d=x=>+`0b${x}`,w={"0000":"terminator","0001":"numeric","0010":"alphanumeric","0100":"byte","0111":"eci",1e3:"kanji"},g="";for(;!(l.length<4);){let x=u(4),S=w[x];if(S===void 0)throw new Error(`Unknown modeBits=${x} res="${g}"`);if(S==="terminator")break;let p=T.lengthBits(n,S),v=d(u(p));if(S==="numeric"){for(;v>=3;){let m=d(u(10));if(m>=1e3)throw new Error(`numberic(3) = ${m}`);g+=m.toString().padStart(3,"0"),v-=3}if(v===2){let m=d(u(7));if(m>=100)throw new Error(`numeric(2) = ${m}`);g+=m.toString().padStart(2,"0")}else if(v===1){let m=d(u(4));if(m>=10)throw new Error(`Numeric(1) = ${m}`);g+=m.toString()}}else if(S==="alphanumeric"){for(;v>=2;){let m=d(u(11));g+=T.alphabet.alphanumerc.encode([Math.floor(m/45),m%45]).join(""),v-=2}v===1&&(g+=T.alphabet.alphanumerc.encode([d(u(6))]).join(""))}else if(S==="byte"){let m=[];for(let b=0;b<v;b++)m.push(+`0b${u(8)}`);g+=new TextDecoder().decode(new Uint8Array(m))}else throw new Error(`Unknown mode=${S}`)}return g}function ve(e){let t=Array.isArray(e.data)?new Uint8Array(e.data):e.data,{height:n,width:o}=e,r=Math.min(n,o),i={x:Math.floor((o-r)/2),y:Math.floor((n-r)/2)},a=kt(e),s=new Uint8Array(r*r*a);for(let c=0;c<r;c++){let h=((c+i.y)*o+i.x)*a,f=c*r*a,l=r*a;s.set(t.subarray(h,h+l),f)}return{offset:i,img:{height:r,width:r,data:s}}}function et(e,t={}){for(let s of["height","width"])if(!Number.isSafeInteger(e[s])||e[s]<=0)throw new Error(`invalid img.${s}=${e[s]} (${typeof e[s]})`);if(!Array.isArray(e.data)&&!(e.data instanceof Uint8Array)&&!(e.data instanceof Uint8ClampedArray))throw new Error(`invalid image.data=${e.data} (${typeof e.data})`);if(t.cropToSquare!==void 0&&typeof t.cropToSquare!="boolean")throw new Error(`invalid opts.cropToSquare=${t.cropToSquare}`);for(let s of["pointsOnDetect","imageOnBitmap","imageOnDetect","imageOnResult"])if(t[s]!==void 0&&typeof t[s]!="function")throw new Error(`invalid opts.${s}=${t[s]} (${typeof t[s]})`);let n={x:0,y:0};t.cropToSquare&&({img:e,offset:n}=ve(e));let o=ce(e);t.imageOnBitmap&&t.imageOnBitmap(o.toImage());let{bits:r,points:i}=me(o);if(t.pointsOnDetect){let s=i.map(c=>({...c,...le(c,n)}));t.pointsOnDetect(s)}t.imageOnDetect&&t.imageOnDetect(r.toImage());let a=pe(r);return t.imageOnResult&&t.imageOnResult(r.toImage()),a}var Bt=et;var ot={};st(ot,{QRCanvas:()=>nt,frameLoop:()=>Se,frontalCamera:()=>be,getSize:()=>Pt,svgToPng:()=>Ee});var Pt=e=>({width:Math.floor(+getComputedStyle(e).width.split("px")[0]),height:Math.floor(+getComputedStyle(e).height.split("px")[0])}),X=(e,t,n)=>{e.height!==t&&(e.height=t),e.width!==n&&(e.width=n)},Y=e=>{let t=e.getContext("2d");if(t===null)throw new Error("Cannot get canvas context");return{canvas:e,context:t}},V=({canvas:e,context:t})=>{t.clearRect(0,0,e.width,e.height)},nt=class{constructor({overlay:t,bitmap:n,resultQR:o}={},r={}){this.lastDetect=0,this.opts={resultBlockSize:8,overlayMainColor:"green",overlayFinderColor:"blue",overlaySideColor:"black",overlayTimeout:500,cropToSquare:!0,...r},this.main=Y(document.createElement("canvas")),t&&(this.overlay=Y(t)),n&&(this.bitmap=Y(n)),o&&(this.resultQR=Y(o),this.resultQR.context.imageSmoothingEnabled=!1)}setSize(t,n){X(this.main.canvas,t,n),this.overlay&&X(this.overlay.canvas,t,n),this.bitmap&&X(this.bitmap.canvas,t,n)}drawBitmap({data:t,height:n,width:o}){if(!this.bitmap)return;let r=new ImageData(Uint8ClampedArray.from(t),o,n),i={x:0,y:0};this.opts.cropToSquare&&(i={x:Math.ceil((this.bitmap.canvas.width-o)/2),y:Math.ceil((this.bitmap.canvas.height-n)/2)}),this.bitmap.context.putImageData(r,i.x,i.y)}drawResultQr({data:t,height:n,width:o}){if(!this.resultQR)return;let r=this.opts.resultBlockSize;X(this.resultQR.canvas,n,o);let i=new ImageData(Uint8ClampedArray.from(t),o,n);this.resultQR.context.putImageData(i,0,0),this.resultQR.canvas.style=`image-rendering: pixelated; width: ${r*o}px; height: ${r*n}px`}drawOverlay(t){if(!this.overlay)return;let n=this.overlay.context,o=this.overlay.canvas.height,r=this.overlay.canvas.width;if(this.opts.cropToSquare&&o!==r){let i=Math.min(o,r),a={x:Math.floor((r-i)/2),y:Math.floor((o-i)/2)};n.clearRect(a.x,a.y,i,i),n.fillStyle=this.opts.overlaySideColor,r>o?(n.fillRect(0,0,a.x,o),n.fillRect(r-a.x,0,a.x,o)):o>r&&(n.fillRect(0,0,r,a.y),n.fillRect(0,o-a.y,r,a.y))}else n.clearRect(0,0,r,o);if(t){let[i,a,s,c]=t;n.fillStyle=this.opts.overlayMainColor,n.beginPath(),n.moveTo(i.x,i.y),n.lineTo(a.x,a.y),n.lineTo(s.x,s.y),n.lineTo(c.x,c.y),n.fill(),n.closePath(),n.fillStyle=this.opts.overlayFinderColor;for(let h of t){if(!("moduleSize"in h))continue;let f=h.x-3*h.moduleSize,l=h.y-3*h.moduleSize,u=7*h.moduleSize;n.fillRect(f,l,u,u)}}}drawImage(t,n,o){this.setSize(n,o);let{context:r}=this.main;r.drawImage(t,0,0,o,n);let i=r.getImageData(0,0,o,n),a={cropToSquare:this.opts.cropToSquare};this.bitmap&&(a.imageOnBitmap=s=>this.drawBitmap(s)),this.overlay&&(a.pointsOnDetect=s=>this.drawOverlay(s)),this.resultQR&&(a.imageOnResult=s=>this.drawResultQr(s));try{let s=Bt(i,a);return this.lastDetect=Date.now(),s}catch{this.overlay&&Date.now()-this.lastDetect>this.opts.overlayTimeout&&this.drawOverlay()}}clear(){V(this.main),this.overlay&&V(this.overlay),this.bitmap&&V(this.bitmap),this.resultQR&&V(this.resultQR)}},rt=class{constructor(t,n){this.stream=t,this.player=n,this.setStream(t)}setStream(t){this.stream=t;let{player:n}=this;n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.setAttribute("playsinline",""),n.srcObject=t}async listDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("Media Devices not supported");return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput").map(n=>({deviceId:n.deviceId,label:n.label||`Camera ${n.deviceId}`}))}async setDevice(t){this.stop();let n=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:t}}});this.setStream(n)}readFrame(t,n=!1){let{player:o}=this;if(n)return t.drawImage(o,o.videoHeight,o.videoWidth);let r=Pt(o);return t.drawImage(o,r.height,r.width)}stop(){for(let t of this.stream.getTracks())t.stop()}};async function be(e){let t=await navigator.mediaDevices.getUserMedia({video:{height:{ideal:window.screen.height},width:{ideal:window.screen.width},facingMode:"environment"}});return new rt(t,e)}function Se(e){let t;function n(o){e(o),t=requestAnimationFrame(n)}return t=requestAnimationFrame(n),()=>{t!==void 0&&(cancelAnimationFrame(t),t=void 0)}}function Ee(e,t,n){return new Promise((o,r)=>{if(!(Number.isSafeInteger(t)&&Number.isSafeInteger(n)&&t>0&&n>0&&t<8192&&n<8192))return r(new Error("invalid width and height: "+t+" "+n));let a=new DOMParser().parseFromString(e,"image/svg+xml"),s=a.documentElement,c=a.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("fill","white"),s.insertBefore(c,s.firstChild);let f=new XMLSerializer().serializeToString(a),l=new Image;l.src="data:image/svg+xml,"+encodeURIComponent(f),l.onload=function(){let u=document.createElement("canvas");u.width=t,u.height=n;let d=u.getContext("2d");if(!d)return r(new Error("was not able to create 2d context"));d.drawImage(l,0,0,t,n);let w=u.toDataURL("image/png");o(w)},l.onerror=r})}return Ut(Ae);})();
/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library @paulmillr/qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
